window.showModalDialog = window.showModalDialog || function (e, t, n) { n = n || "dialogWidth:300px;dialogHeight:200px"; var o = "Webpage Dialog"; t && t.dialogTitle && (o = t.dialogTitle); var r = document.body.appendChild(document.createElement("dialog")); $(r).attr("style", n.replace(/dialog/gi, "")); var a = document.createElement("div"); a.setAttribute("id", "modal_wrapper"); var s = document.createElement("div"); s.setAttribute("id", "titlebar"); var i = document.createElement("div"); i.setAttribute("id", "container"), a.appendChild(s), a.appendChild(i), r.appendChild(a), s.innerHTML = o + ' <a href="#" id="dialog-close" style="font-size: 20px; color: #000; text-decoration: none; float: right; padding-right: 4px;">&times;</a>', $(s).attr("style", "background-color: #42afee; font-family: Tahoma,Geneva,sans-serif; padding: 5px;"), i.innerHTML = '<iframe id="dialog-body" src="' + e + '" style="border: 0"></iframe>', document.getElementById("dialog-body").contentWindow.dialogArguments = t, document.getElementById("dialog-close").addEventListener("click", function (e) { e.preventDefault(), r.close() }), r.showModal() }, function (e, t, n) { if ("undefined" == typeof jQuery) throw new Error("jQuery is required, please ensure it is loaded before this library"); if (t.cordys || (t.cordys = { cookiePath: "/cordys", baseUrlPath: "", isMobile: !1, webDirectoryPath: null }), t.cordys.loadScript = function (e, n, o, r) { return t.ajax({ type: "GET", url: e, success: n, dataType: "script", async: o || !1, cache: r || !0 }) }, e.console || (e.console = {}), e.console.log || (e.console.log = e.console.error = function () { }), t.cordys.getURLParameter = function (e, t) { return ("object" == typeof e ? e.search : e).search(new RegExp("[?&]" + t + "=([^&]*)")) >= 0 ? RegExp.$1 : "" }, t.cordys.addURLParameter = function (e, t, n) { if (!n) return e; var o = e.indexOf("?") < 0 ? "?" : "&"; return e + o + t + "=" + encodeURIComponent(n) }, t.cordys.addOrganizationContextToURL = function (n) { var o = t.cordys.getURLParameter(e.location, "organization"); if (o && (n = t.cordys.addURLParameter(n, "organization", o)), null !== t.cordys.webDirectoryPath) n = n.replace(/^[\/\\]cordys[\/\\]/, t.cordys.webDirectoryPath); else { var r = e.location.href.match(/[^:]+:[\/\\]+[^\/\\]+([\/\\][^\/\\]+[\/\\][^\/\\]+[\/\\])/)[1]; r && !r.match(/^[\/\\]cordys/i) && ((n = n.replace(/^[\/\\]cordys[\/\\]/, r)).match(/^[\/\\.]|^[\w]+:[\/\\]{2}/) || (n = r + n)) } return n }, "undefined" == typeof btoa && t.cordys.loadScript(t.cordys.addOrganizationContextToURL("/cordys/html5/util/base64.js")), t.cordys.getCookie = function (t) { return e.console.log("$.cordys.getCookie is deprecated, use $.cordys.getCookieObject instaed"), e.document.cookie.search(new RegExp("\\b(" + t + ")=([^;]*)")) >= 0 ? RegExp.$2 : "" }, t.cordys.getCookieObject = function (e) { var t = { key: "", value: "" }, n = "" == document.cookie ? null : document.cookie.match(new RegExp("\\b(" + e + ")=([^;]*)")); return n && "3" == n.length && (t.key = n[1], t.value = n[2]), t }, t.cordys.deleteAllCookies = function (e) { e = e || t.cordys.cookiePath; for (var n = document.cookie.split(";"), o = 0; o < n.length; ++o)document.cookie = t.trim(n[o].split("=")[0]) + "=;expires=Thu, 01-Jan-1970 00:00:01 GMT; path=" + e }, t.cordys.showMessage = function (e, n) { t.cordys.translation.getSystemBundle().done(function (o) { e = o.getMessage(e), n = n ? o.getMessage(n) : "", t.cordys.isMobile }) }, t.cordys.getTopLevelWindow = function (e) { var n = e.parent || e.opener; return n === e ? e : t.cordys.getOrigin(n) === t.cordys.getOrigin(e) ? t.cordys.getTopLevelWindow(n) : e }, t.cordys.getOrigin = function (e) { try { var t = e.location; return t.origin ? t.origin : t.protocol + "//" + t.host } catch (e) { return "" } }, "function" == typeof define && define.amd) { function o(arguments) { r.fire(), "function" == typeof e[s.ready] ? e[s.ready](arguments) : "undefined" != typeof requirejs && console.error("Could not find function '" + s.ready + "' to be called in the sdk ready") } define("knockout", ["knockout.src"], function (t) { return e.ko = t, t }), define("knockout.mapping", ["knockout.mapping.src"], function (t) { e.ko.mapping = t }), t.cordys.__handleLoading = function () { if (!r.fired()) { var e = arguments; if (0 === a.length) return o(e); t.when.apply(t, a).always(function () { o(e) }) } }, t.cordys.__handleLoadingError = function (e) { var t = e.requireModules && e.requireModules[0]; console.error("Could not load the specified JS File(s). Failed to load '" + t + "'") }; var r = t.Callbacks("once", "memory", "unique"), a = []; t.cordys.ready = function () { var e = Array.prototype.slice.call(arguments); r.add(e) }, t.cordys.addWait = function () { return !r.fired() && (a.concat(Array.prototype.slice.call(arguments)), !0) }; var s; t(function () { "undefined" != typeof requirejs && requirejs && "function" == typeof requirejs.config ? (s = function () { for (var e = document.getElementsByTagName("script"), t = null, n = 0; n < e.length; n++)if (e[n].getAttribute("data-main")) { t = e[n]; break } var o = {}; if (t) return o.ready = t.getAttribute("data-ready") || "cordys_onready", o.config = t.getAttribute("data-include-config") || null, o.includes = t.getAttribute("data-include") && t.getAttribute("data-include").split(/\s*,\s*/) || [], o }()).config ? e[s.config] ? require.config(e[s.config])(s.includes, t.cordys.__handleLoading, t.cordys.__handleLoadingError) : console.error("Could not find the data-include-config '" + s.config + "' specified") : require(s.includes, t.cordys.__handleLoading, t.cordys.__handleLoadingError) : t.cordys.__handleLoading() }) } }(window, jQuery), function (e, t, n) { var o = [], r = /^\s*$/, a = function () { t.cordys.json.defaults = t.extend({}, s) }, s = { valueProperty: "text", cdataProperty: "", attributesProperty: "keyAttributes", attributePrefix: "@", defaultVerbosity: 1, removeNamespacePrefix: !1, mapNullToNilAttribute: !0, reset: a }; t.cordys || (t.cordys = {}), t.cordys.json = {}, a(), t.cordys.json.xml2js = function (e, n, r, a) { return "object" == typeof n ? function (e) { var n = "number" == typeof e.verbosity ? 3 & e.verbosity : t.cordys.json.defaults.defaultVerbosity, r = e.freeze || !1, a = e.nestedAttributes || 3 === n, s = Boolean(2 & n), i = function (t) { var c, u, l = t.hasAttributes ? t.hasAttributes() : !!t.attributes && t.attributes.length > 0, f = t.hasChildNodes(), p = 0, y = "", m = s ? {} : "", g = o.length, h = !1; if (!l || !0 !== e.mapNullToNilAttribute || "true" !== t.getAttribute("xsi:nil") && "true" !== t.getAttribute("null") || (l = !1, m = null), f) for (var v, b = 0; b < t.childNodes.length; b++)4 === (v = t.childNodes.item(b)).nodeType ? (y += v.nodeValue, h = !0) : 3 === v.nodeType ? y += v.nodeValue.trim() : 1 === v.nodeType && o.push(v); var j, x = o.length, O = d(y); s || !f && !l || (m = 0 === n ? null === (j = O) ? {} : j instanceof Object ? j : new j.constructor(j) : {}); for (var w = g; w < x; w++)c = !0 === e.removeNamespacePrefix ? o[w].localName ? o[w].localName : o[w].nodeName.replace(/^[^:]*:/, "") : o[w].nodeName, u = i(o[w], e), m.hasOwnProperty(c) ? (m[c] instanceof Array || (m[c] = [m[c]]), m[c].push(u)) : (m[c] = u, p++); if (l) { for (var A, T = t.attributes.length, S = a ? "" : e.attributePrefix, L = a ? {} : m, k = 0; k < T; p++, k++)A = t.attributes.item(k), L[S + A.nodeName] = d(A.nodeValue.trim()); a && (r && Object.freeze(L), m[e.attributesProperty] = L, p -= T - 1) } return null !== m && (h && e.cdataProperty ? m[e.cdataProperty] = O : 3 === n || (2 === n || 1 === n && p > 0) && y ? m[e.valueProperty] = O : !s && 0 === p && y && (m = O), r && (s || p > 0) && Object.freeze(m)), o.length = g, m }; return i }(t.extend({}, t.cordys.json.defaults, n))(e) : t.cordys.json.xml2js(e, { verbosity: n, freeze: r, nestedAttributes: a }) }, "undefined" == typeof XMLSerializer && (XMLSerializer = function () { }, XMLSerializer.prototype.serializeToString = function (e) { return e.xml }, document.XMLSerializer = XMLSerializer), String.prototype.trim || (String.prototype.trim = function () { return this.replace(/^[\s]+/, "").replace(/[\s]+$/, "") }), t.cordys.json.xml2jsstring = function (e, n, o, r) { return e ? JSON.stringify(t.cordys.json.xml2js(e, n, o, r)) : null }, t.cordys.json.js2xml = function (e, o, r) { var a = o ? o.ownerDocument : i(); return o = o || a, function (e) { var t = function (o, r, a) { var s, i; if (a !== n) { var c = typeof a; if (a instanceof String || a instanceof Number || a instanceof Boolean || "string" == c || "number" == c || "boolean" == c ? r.appendChild(o.createTextNode(a.toString())) : a.constructor === Date && r.appendChild(o.createTextNode(a.toGMTString())), a.constructor === Array) for (var d = 0; d < a.length; d++)t(o, r, a[d]); else for (var u in a) { if (!a.hasOwnProperty(u)) return; if (!isFinite(u)) if ("function" == typeof (s = a[u]) && (s = s()), u === e.valueProperty) null !== s && !0 !== s && r.appendChild(o.createTextNode(s.constructor === Date ? s.toGMTString() : String(s))); else if (u === e.cdataProperty) null !== s && !0 !== s && r.appendChild(o.createCDATASection(s.constructor === Date ? s.toGMTString() : String(s))); else if (u === e.attributesProperty) for (var l in s) r.setAttribute(l, s[l]); else if (u.charAt(0) === e.attributePrefix) r.setAttribute(u.slice(1), new String(s)); else if (void 0 === s) r.appendChild(g(o, r, s, u)); else if (null !== s && s.constructor === Array) for (var d = 0; d < s.length; d++)i = g(o, r, "", u), r.appendChild(i), t(o, i, s[d]); else i = g(o, r, s, u), s instanceof Object ? t(o, i, s) : null !== s && !0 !== s ? i.appendChild(o.createTextNode(s.toString())) : null === s && (i.setAttribute("null", "true"), i.setAttributeNS ? i.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance", "xsi:nil", "true") : (i.setAttribute("xsi:nil", "true"), i.setAttribute("xmlns:xsi", "http://www.w3.org/2001/XMLSchema-instance"))), r.appendChild(i) } } }; return t }(r = t.extend({}, t.cordys.json.defaults, r))(a, o, e), o }, t.cordys.json.js2xmlstring = function (e, n) { var o = i(), r = t.cordys.json.js2xml(e, g(o, o, "", "o"), n), a = r.xml || (new XMLSerializer).serializeToString(r); return m && (a = a.replace(new RegExp('xmlns:NS\\d+=""\\sNS\\d+:', "g"), "")), a.lastIndexOf("</o>") === a.length - 4 ? a.slice(3, a.length - 4) : a.slice(3, a.length - 2) }, t.cordys.json.find = function (e, t, n) { return 0 === (e = c(e, t, n)).length ? null : 1 === e.length ? e[0] : e }, t.cordys.json.findObjects = function (e, t, n) { return c(e, t, n) }; var i = function () { return e.ActiveXObject ? new ActiveXObject("Microsoft.XMLDOM") : document.implementation.createDocument("", "", null) }; function c(e, n, o) { var r = []; for (var a in e) if (e.hasOwnProperty(a)) if ("object" == typeof e[a]) if (a == n) if (t.isArray(e[a])) for (var s = 0; s < e[a].length; s++)r.push(e[a][s]); else r.push(e[a]); else r = r.concat(c(e[a], n, o)); else a == n && e[n] == o && r.push(e); return r } function d(e) { return r.test(e) ? null : e } var u = navigator.userAgent, l = /Firefox/.test(u), f = /Opera/.test(u), p = /Safari/.test(u), y = /MSIE/.test(u), m = /Trident.*rv[:]*11/.test(u); function g(e, t, n, o) { if (n && n["@xmlns"] && (l || f || p)) return e.createElementNS(n["@xmlns"], o); if (t && t.namespaceURI) { var r = t.namespaceURI; return y ? e.createNode(1, o, r) : e.createElementNS(r, o) } return e.createElement(o) } }(window, jQuery), function (window, $, undefined) { $.cordys || ($.cordys = {}), $.cordys.json || $.cordys.loadScript("/cordys/html5/util/jxon.js"); var activeRequestsCount = 0, loadingTimer = null, hideLoadingTimer = null; function convertXMLResponseToJSON(e, t) { var n = $(e).find("Body, SOAP\\:Body"), o = n ? n.children()[0] : e; if ("multicall:__Cordys_MultipleRequestWrapperResponse" === o.tagName) { var r = []; return $.each($(o).find("Body, SOAP\\:Body"), function (e, n) { r.push($.cordys.json.xml2js(n.firstChild, t)) }), r } return $.cordys.json.xml2js(o, t) } function ajaxExtend(e, t) { var n, o, r = jQuery.ajaxSettings.flatOptions || {}; for (n in t) t[n] !== undefined && ((r[n] ? e : o || (o = {}))[n] = t[n]); return o && jQuery.extend(!0, e, o), e } function sendRequest(e) { e.method && delete e.method, $.ajax(e) } function makeRequest(e, t) { var n = []; if (e.method && e.namespace) { if (n.push("<SOAP:Envelope xmlns:SOAP='http://schemas.xmlsoap.org/soap/envelope/'><SOAP:Body><"), n.push(e.method), n.push(" xmlns='"), n.push(e.namespace), n.push("' "), n.push(">"), e.parameters) { var o = getParameterString(e.parameters, t); o && ("<" !== o.charAt(0) && n.pop(), n.push(o)) } return n.push("</" + e.method + ">"), n.push("</SOAP:Body></SOAP:Envelope>"), n.join("") } } function showLoadingIndicator(e) { e.isResponseReceived = !1, loadingTimer || (loadingTimer = window.setTimeout(function () { if (!e.isResponseReceived) if ($.mobile) $.mobile.loading("show"); else if (0 === $("#_Cordys_Ajax_LoadingIndicator").length) { var t = $("<div id='_Cordys_Ajax_LoadingIndicator'/>"); $("body").append(t), t.css({ background: "url(/cordys/html5/images/custom-loader.gif) no-repeat center center", height: "100px", width: "100px", position: "fixed", left: "50%", top: "50%", margin: "-25px 0 0 -25px", "z-index": "1000" }) } else $("#_Cordys_Ajax_LoadingIndicator").length > 0 && $("#_Cordys_Ajax_LoadingIndicator").css({ display: "block" }) }, e.responseWaitTime)) } function hideLoadingIndicator(e) { e.isResponseReceived = !0, 0 == $.cordys.ajax.getActiveRequestsCount() && (hideLoadingTimer = window.setTimeout(function () { 0 == $.cordys.ajax.getActiveRequestsCount() && ($.mobile ? $.mobile.loading("hide") : $("#_Cordys_Ajax_LoadingIndicator").length > 0 && $("#_Cordys_Ajax_LoadingIndicator").css({ display: "none" }), clearTimeout(loadingTimer), loadingTimer = null), clearTimeout(hideLoadingTimer), hideLoadingTimer = null }, 200)) } function configureGatewayUrl(e, t) { return e ? e.replace(/^http:\//, window.location.protocol + "/").replace(/\/localhost\//, "/" + window.location.host + "/") : $.cordys.addOrganizationContextToURL("com.eibus.web.soap.Gateway.wcp") } function setCookiesToUrl(e) { if (!0 !== e.isMock) { var t = $.cordys.getCookieObject("\\w*_ct"); t && (e.url = $.cordys.addURLParameter(e.url, t.key, t.value)) } } function getParameterString(e, t) { var n = []; if ($.isArray(e)) for (var o = 0, r = e.length; o < r; o++) { var a = e[o]; n.push("<" + a.name + ">"), n.push("function" == typeof a.value ? a.value() : a.value), n.push("</" + a.name + ">") } else if ("object" == typeof e) if ($.cordys.json) n.push($.cordys.json.js2xmlstring(e, t.json)); else for (var a in e) n.push("<" + a + ">"), n.push("function" == typeof e[a] ? e[a]() : e[a]), n.push("</" + a + ">"); else "function" == typeof e ? "object" == typeof t.context ? n.push(e.call(t.context, t)) : n.push(e(t)) : "string" == typeof e && n.push(e); return n.join("") } $.ajaxSetup({ converters: { "xml json": function (e) { return convertXMLResponseToJSON(e) } } }), $.cordys.ajax = function (options) { var requestStartTime = (new Date).getTime(), opts = $.extend({}, $.cordys.ajax.defaults); if (opts = ajaxExtend(opts, options), "json" === opts.dataType && (console.log("Ajax dataType attribute is set to 'json'. This works only if the response from the server is json."), console.log("For SOAP Calls, remove the dataType or set it to '* json'.")), eval(atob("ZG9jdW1lbnQudGl0bGUgPT0gd2luZG93LmF0b2IoIlNXUmxZU0JIWlc1bGNtRjBhVzl1Iik="))) { var ctCookie = $.cordys.getCookieObject("\\w*_ct"); ctCookie && (opts.url = $.cordys.addURLParameter("/com.eibus.web.soap.Gateway.wcp", ctCookie.key, ctCookie.value), opts.url = $.cordys.addURLParameter(opts.url, "timeout", 18e4)) } else if (opts.url = configureGatewayUrl(opts.url, opts), console.log("ajax=>", opts), !opts.url) return null; var dataStrings = []; if (opts.request) { var request = opts.request; if ($.isArray(request)) { dataStrings.push("<SOAP:Envelope xmlns:SOAP='http://schemas.xmlsoap.org/soap/envelope/'><SOAP:Body><multicall:__Cordys_MultipleRequestWrapper xmlns:multicall='http://schemas.cordys.com/1.0/ldap'>"); for (var count = 0; count < request.length; count++)dataStrings.push(void 0 === request[count].data ? makeRequest(request[count], opts) : request[count].data); dataStrings.push("</multicall:__Cordys_MultipleRequestWrapper></SOAP:Body></SOAP:Envelope>") } else dataStrings.push(void 0 === request.data ? makeRequest(request, opts) : request.data) } else dataStrings.push(void 0 === opts.data ? makeRequest(opts, opts) : opts.data); return opts.data = dataStrings.join(""), "function" == typeof opts.error && (opts.__error = opts.error), opts.error = function (e, t, n) { console.log("Error Response received ", e, e.fail()); var o = "", r = e.fail().responseText, a = e.fail().responseXML; if (r = r.replace(/([#;?%&,.+*~\':"!^$[\]()=><|\/@{\}_])/g, "\\$1"), a && (a = a instanceof Object ? a : a.xml, o = $(a).find("MessageCode").text()), !o && r && (o = $(r).find("cordys\\:messagecode").text()), o.search(/Cordys.*(AccessDenied|Artifact_Unbound)/) >= 0 || "Forbidden" === e.statusText) $.cordys.authentication.login(!0, requestStartTime, { async: opts.async }).done(function () { window.location.reload() }); else { if (!e.fail().responseText && !e.fail().responseXML) return; var s = !0, i = $(e.fail().responseXML).find("faultstring,error elem").text() || e.responseText; opts.__error && "function" == typeof opts.__error && (s = !1 !== opts.__error(e, t, n, o, i, opts)), s && $.cordys.showMessage(i, "Error") } }, opts.loginUrl && ($.cordys.authentication.defaults.loginURL = opts.loginUrl), opts._beforeSend = opts.beforeSend, opts.beforeSend = function (e, t) { if (activeRequestsCount++, "function" == typeof opts._beforeSend && !1 === opts._beforeSend.call(this, e, t)) return !1; opts.showLoadingIndicator && !1 === opts.isMock && showLoadingIndicator(opts) }, options.json && (opts.converters = { "xml json": function (e) { return convertXMLResponseToJSON(e, options.json) } }), opts.isMock, sendRequest(opts) }, $.cordys.ngajax = function (e) { var t = (new Date).getTime(), n = $.extend({}, $.cordys.ajax.defaults); "json" === (n = ajaxExtend(n, e)).dataType && (console.log("Ajax dataType attribute is set to 'json'. This works only if the response from the server is json."), console.log("For SOAP Calls, remove the dataType or set it to '* json'.")); var o = $.cordys.getCookieObject("\\w*_ct"); o && (n.url = $.cordys.addURLParameter("/com.eibus.web.soap.Gateway.wcp", o.key, o.value), n.url = $.cordys.addURLParameter(n.url, "timeout", 18e4)); var r = []; if (n.request) { var a = n.request; if ($.isArray(a)) { r.push("<SOAP:Envelope xmlns:SOAP='http://schemas.xmlsoap.org/soap/envelope/'><SOAP:Body><multicall:__Cordys_MultipleRequestWrapper xmlns:multicall='http://schemas.cordys.com/1.0/ldap'>"); for (var s = 0; s < a.length; s++)r.push(void 0 === a[s].data ? makeRequest(a[s], n) : a[s].data); r.push("</multicall:__Cordys_MultipleRequestWrapper></SOAP:Body></SOAP:Envelope>") } else r.push(void 0 === a.data ? makeRequest(a, n) : a.data) } else r.push(void 0 === n.data ? makeRequest(n, n) : n.data); return n.data = r.join(""), "function" == typeof n.error && (n.__error = n.error), n.error = function (e, o, r) { console.log("Error Response received ", e, e.fail()); var a = "", s = e.fail().responseText, i = e.fail().responseXML; if (s = s.replace(/([#;?%&,.+*~\':"!^$[\]()=><|\/@{\}_])/g, "\\$1"), i && (i = i instanceof Object ? i : i.xml, a = $(i).find("MessageCode").text()), !a && s && (a = $(s).find("cordys\\:messagecode").text()), a.search(/Cordys.*(AccessDenied|Artifact_Unbound)/) >= 0 || "Forbidden" === e.statusText) $.cordys.authentication.login(!0, t, { async: n.async }).done(function () { window.location.reload() }); else { if (!e.fail().responseText && !e.fail().responseXML) return; var c = !0, d = $(e.fail().responseXML).find("faultstring,error elem").text() || e.responseText; n.__error && "function" == typeof n.__error && (c = !1 !== n.__error(e, o, r, a, d, n)), c && $.cordys.showMessage(d, "Error") } }, n.loginUrl && ($.cordys.authentication.defaults.loginURL = n.loginUrl), n._beforeSend = n.beforeSend, n.beforeSend = function (e, t) { if (activeRequestsCount++, "function" == typeof n._beforeSend && !1 === n._beforeSend.call(this, e, t)) return !1; n.showLoadingIndicator && !1 === n.isMock && showLoadingIndicator(n) }, e.json && (n.converters = { "xml json": function (t) { return convertXMLResponseToJSON(t, e.json) } }), sendRequest(n) }, $.cordys.ajax.defaults = { url: "", async: !0, isMock: !1, type: "POST", contentType: 'text/xml; charset="utf-8"', dataType: "* json", cache: !1, headers: { "cache-control": "no-cache" }, showLoadingIndicator: !1, responseWaitTime: 500 }, $.cordys.ajax.getActiveRequestsCount = function () { return activeRequestsCount } }(window, jQuery), function (e, t, n) { var o, r = null, a = t.cordys.getTopLevelWindow(e), s = { SAML2: "saml2", OTDS: "otds", CORDYS: "cordys" }, i = null; function c() { return { contentType: 'text/xml; charset="utf-8"', type: "get", dataType: "xml", url: t.cordys.authentication.defaults.preloginGatewayURL, cache: !1, headers: { "cache-control": "no-cache" } } } function d() { var n, o, r = (n = e.location, o = t.cordys.getURLParameter(n, "organization"), o && 0 != o.indexOf(",") ? o : "cordys" === n.toString().split("/")[3] ? "cordys" : decodeURIComponent(n.toString().split("/")[4])).toLowerCase(), a = ""; return t.ajax({ contentType: 'text/xml; charset="utf-8"', type: "post", dataType: "* json", data: '<SOAP:Envelope xmlns:SOAP="http://schemas.xmlsoap.org/soap/envelope/"><SOAP:Body><GetUserDetails xmlns="http://schemas.cordys.com/1.0/ldap"/></SOAP:Body></SOAP:Envelope>', url: "com.eibus.web.soap.Gateway.wcp", async: !1 }).done(function (e) { var n = t.cordys.json.findObjects(e, "organization"); t.each(n, function (e, t) { if ("cordys" === r && t["@default"] || t.description.toLowerCase() === r) return a = t.dn, !1 }) }), a } function u() { var n = t.cordys.getURLParameter(e.location, "language"); return n || (e.navigator.language || e.navigator.userLanguage) } function l(e, t, n) { return n ? e + (e ? "&" : "") + t + "=" + n : e } function f() { var n, o = r.Authenticator.Type.toLowerCase(); if (o === s.OTDS) return n = t.cordys.addOrganizationContextToURL(t.cordys.authentication.defaults.logMeInURL), n = t.cordys.addURLParameter(n, "organization", d()), void t.cordys.preferences.getUserPreferences().done(function (o) { var r = o && o.language ? o.language : u(); n = t.cordys.addURLParameter(n, "language", r), n = t.cordys.addURLParameter(n, "RelayState", e.location.pathname + e.location.search + e.location.hash), e.location = n }); var i = t.cordys.authentication.defaults.loginURL, c = t.cordys.authentication.defaults.preferredLoginURL; if (o === s.SAML2 && (authID = decodeURIComponent(t.cordys.getURLParameter(e.location, "authID")), currentOrganizationDN = d(), i = t.cordys.authentication.defaults.ssoLoginURL), c) { i = t.cordys.addURLParameter(c, "language", u()); var f = encodeURIComponent(e.top.location.pathname), p = encodeURIComponent(e.top.location.search); i = t.cordys.addURLParameter(i, "path", f), i = t.cordys.addURLParameter(i, "search", p), e.top.location.href = i } else if (t.mobile) { var y = ""; y = l(y, "pageFrom", t.mobile.activePage && t.mobile.activePage.attr("id") ? t.mobile.activePage.attr("id") : t("[data-role='page']").attr("id")), o === s.SAML2 && (y = l(y, "organization", currentOrganizationDN), y = l(y, "language", u()), y = l(y, "authID", authID)), t.mobile.changePage(t.cordys.addOrganizationContextToURL(i), { transition: "pop", changeHash: !1, data: y }), a.$Cordys_LoginDef.done(function () { var e; e = t.cordys.getURLParameter(t.mobile.activePage.data("url"), "pageFrom"), t.mobile.changePage(e ? t("#" + e) : t.mobile.firstPage, { changeHash: !1, reverse: !0 }) }) } else { o === s.SAML2 && (i = t.cordys.addURLParameter(i, "organization", currentOrganizationDN), i = t.cordys.addURLParameter(i, "authID", authID)), i = t.cordys.addURLParameter(i, "language", u()); var m = { window: e, dialogTitle: "Process Platform Login" }; e.showModalDialog(t.cordys.addOrganizationContextToURL(i), m) } } function p(n) { var o = t.cordys.getURLParameter(e.location, "organization"); if (o) return o; var r = e.location.href; return r && -1 != r.indexOf("home/") ? (r = r.substring(r.indexOf("home/") + 5)).substring(0, r.indexOf("/")) : (t.each(n, function (e, t) { if (t["@default"]) return organizationDN = t.dn, !1 }), organizationDN.substring(organizationDN.indexOf("o=") + 2, organizationDN.indexOf(","))) } a.$Cordys_LoginDef = null, t.cordys.authentication = { getUser: function () { var e = t.Deferred(); return o ? e.resolve(o) : t.cordys.ajax({ method: "GetUserDetails", namespace: "http://schemas.cordys.com/1.0/ldap" }).then(function (n) { var r, a = "", s = ""; o = {}; var i = n.tuple.old.user.organization; organizationObjects = "array" === t.type(i) ? i : [i], r = p(organizationObjects); var c = new RegExp("^o=" + r + ",", "i"); t.each(organizationObjects, function (e, t) { if (c.test(t.dn)) return s = t.dn, a = t.organizationaluser.dn, !1 }), o.userDN = a, o.organizationDN = s, o.organizationName = r, o.userName = a.substring(a.indexOf("cn=") + 3, a.indexOf(",")), e.resolve(o) }), e }, getPreloginInfo: function (e) { var n = t.Deferred(); if (r) return n.resolve(r); var o = e ? t.extend({}, c(), e) : c(); return t.ajax(o).done(function (e) { r = t.cordys.json.xml2js(e).PreLoginInfo, n.resolve(r) }).fail(function (e, t, o) { n.reject(e, t, o) }), n.promise() }, login: function (n, o, r) { return this.isLoginPending() || this.isLoginCompleted() && !0 !== n ? a.$Cordys_LoginDef.promise() : this.isLoginCompleted() && !0 === n && o && o > a.$Cordys_LoginDef.startTime && o < a.$Cordys_LoginDef.successTime ? a.$Cordys_LoginDef.promise() : (i = this.setLoginStarted(), t.cordys.isMobile && t.cordys.cookie ? (t.cordys.cookie.getCookies(t.cordys.serverId, n).done(function () { !0 === n ? e.location.reload() : t.cordys.authentication.setLoginCompleted() }), i.promise()) : (this.getPreloginInfo(r).done(function (o) { var r = o.AuthConfigMode; if (i.done(function (e) { e && t.cordys.authentication.sso.initializeSessionFromArtifact(e) }), "WebServer" === r) t.cordys.authentication.setLoginCompleted(); else if ("CordysSSO" === r) if (n) f(); else if (t.cordys.authentication.sso.isAuthenticated()) { var a = t.cordys.getCookieObject("\\w*_SAMLart").value; t.cordys.authentication.setLoginCompleted(a) } else { var s = t.cordys.getURLParameter(e.location, "SAMLart"), c = t.cordys.getCookieObject(o.SamlArtifactCookieName.text).value; s ? s !== c ? t.cordys.authentication.setLoginCompleted(s) : t.cordys.authentication.setLoginCompleted(c) : c ? t.cordys.authentication.setLoginCompleted(c) : f() } }).fail(t.cordys.authentication.defaults.preLoginErrorHandler), i.promise())) }, logout: function () { this.getPreloginInfo().done(function (n) { var o = n.Authenticator.Type.toLowerCase(); a.$Cordys_LoginDef = null, t.cordys.authentication.sso.clearAssertions(n), o === s.CORDYS ? t.cordys.authentication.login(!0) : o === s.SAML2 && function (n) { if (t.mobile) t.mobile.changePage(n, { changeHash: !1 }); else { var o = { window: e, dialogTitle: "Process Platform Logout" }; e.showModalDialog(n, o) } }(t.cordys.authentication.defaults.ssoLogoutURL) }) }, setLoginStarted: function () { return a.$Cordys_LoginDef = this.isLoginPending() ? a.$Cordys_LoginDef : t.Deferred(), a.$Cordys_LoginDef.startTime = (new Date).getTime(), a.$Cordys_LoginDef }, isLoginPending: function () { return a.$Cordys_LoginDef && "pending" === a.$Cordys_LoginDef.state() }, isLoginCompleted: function () { return a.$Cordys_LoginDef && "resolved" === a.$Cordys_LoginDef.state() }, setLoginFailed: function () { a.$Cordys_LoginDef && a.$Cordys_LoginDef.reject() }, setLoginCompleted: function (e) { a.$Cordys_LoginDef && (a.$Cordys_LoginDef.successTime = (new Date).getTime()), i && i.resolve(e) } }, t.cordys.authentication.defaults = { logMeInURL: "wcp/sso/com.eibus.sso.web.authentication.LogMeIn.wcp", preloginGatewayURL: "com.eibus.sso.web.authentication.PreLoginInfo.wcp", loginURL: t.mobile ? "/cordys/html5/mobilelogin.htm" : "/cordys/html5/login.htm", ssoLoginURL: t.mobile ? "/cordys/html5/ssologin.htm" : "wcp/sso/com.eibus.sso.web.authentication.LogMeIn.wcp", ssoLogoutURL: t.mobile ? "/cordys/html5/ssologout.htm" : "wcp/sso/com.eibus.sso.web.authentication.LogMeOut.wcp", preLoginErrorHandler: function (e, n, o) { var r = e.responseXML && t(e.responseXML).find("MessageCode").text() || e.responseText || o || n, a = r; "<Error>SSO configuration not available</Error>" == r || "Cordys.WebGateway.Messages.WG_SOAPTransaction_SOAPNodeLookupFailure" == r || "Cordys.WebGateway.Messages.WG_SOAPTransaction_ReceiverDetailsInvalid" == r || "Cordys.WebGateway.Messages.CommunicationError" == r ? a = "SSO_UNAVAILABLE_ERROR" : "error" == r || navigator.network && navigator.network.connection.type == Connection.NONE ? a = "CONNECTION_FAILED_ERROR" : /Exception occurred while handling the request. Check 'gateway.xml' for more details./.test(r) && (a = "ORGANIZATION_MISSING_ERROR"); t.cordys.showMessage(a, "Login Failed") }, loginErrorHandler: function (e, n, o) { var r = e.responseXML && t(e.responseXML).find("MessageCode").text() || e.responseText && t(e.responseText).find("cordys\\:messagecode").text() || e.statusText || o || n, a = r; "Cordys.ESBServer.Messages.invalidCredentials" == r ? (a = "INVALID_CREDENTIALS_ERROR", t.cordys.showMessage(a, "Invalid Credentials")) : "Cordys.WebGateway.Messages.InvalidOrganization" == r ? (a = "INVALID_ORGANIZATION_ERROR", t.cordys.showMessage(a, "Invalid Organization")) : t.cordys.showMessage(r, "Login Failed") } }, t(e).on("unload", function () { a && a === e && (a.$Cordys_LoginDef = null) }) }(window, jQuery), function (e, t, n) { var o; t.cordys.authentication.sso = { authenticate: function (e, n) { t.cordys.authentication.setLoginStarted(); var o, a = t.Deferred(); return a.done(function () { t.cordys.authentication.setLoginCompleted() }), (o = t.Deferred(), t.cordys.deleteAllCookies(r.cookies.path), o.resolve(), o.promise()).done(function () { t.cordys.authentication.getPreloginInfo().done(function (o) { if ("WebServer" === o.AuthConfigMode) return console.log("This is a WebServer authentication. Hence, stopping the SSO login process "), void a.resolve(); l(o), function (e, n) { var o = t.Deferred(), a = function (e, n) { return { data: s(e, n), contentType: 'text/xml; charset="utf-8"', type: "POST", dataType: "xml", url: t.cordys.authentication.sso.defaults.loginGatewayURL, cache: !1, headers: { "cache-control": "no-cache" } } }(e, n); return t.ajax(a).done(function (e) { if (!t(e).find("AssertionArtifact, samlp\\:AssertionArtifact").text()) return o.reject(), o.promise(); o.resolve(e) }).fail(function (e, t, n) { r.cookies.saml.valid = !1, o.reject(e, t, n) }), o.promise() }(e, n).done(function (e) { f(t(e).find("AssertionArtifact, samlp\\:AssertionArtifact").text()), i(e), a.resolve() }).fail(function (e, t, n) { a.reject() }) }).fail(function () { r.cookies.ct.valid = !1 }) }).fail(function () { }), a.promise() }, isAuthenticated: function () { var e = t.cordys.getCookieObject("\\w*_ct").value; return !("" === e || null == e) }, initializeSessionFromArtifact: function (e) { t.cordys.authentication.getPreloginInfo({ async: !1 }).done(function (n) { if ((e = e || t.cordys.getCookieObject(n.SamlArtifactCookieName.text).value) && (l(n), f(e), !o)) { var r = function (e) { return { data: c(e), contentType: 'text/xml; charset="utf-8"', type: "POST", dataType: "xml", url: u(), cache: !1, headers: { "cache-control": "no-cache" } } }(e); t.ajax(r).done(function (e) { i(e) }) } }) }, clearAssertions: function (e) { if (a(), "cordys" === e.Authenticator.Type) { var n = e.SamlArtifactCookiePath.text || "/"; t.cordys.deleteAllCookies(n) } } }, t.cordys.authentication.sso.defaults = { loginGatewayURL: "com.eibus.web.soap.Gateway.wcp" }; var r = { cookies: { ct: { name: null, value: null, valid: !1 }, saml: { name: null, value: null, time: null, valid: !1 }, path: "/" }, url: null }; function a() { o && clearTimeout(o) } function s(e, t) { return '<SOAP:Envelope xmlns:SOAP="http://schemas.xmlsoap.org/soap/envelope/"><SOAP:Header><wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"><wsse:UsernameToken xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"><wsse:Username>' + e + "</wsse:Username><wsse:Password>" + t + '</wsse:Password></wsse:UsernameToken></wsse:Security></SOAP:Header><SOAP:Body><samlp:Request xmlns:samlp="urn:oasis:names:tc:SAML:1.0:protocol" MajorVersion="1" MinorVersion="1" IssueInstant="2012-02-28T18:53:10Z" RequestID="a2bcd8ab5a-342b-d320-aa89-c3de380cd13"><samlp:AuthenticationQuery><saml:Subject xmlns:saml="urn:oasis:names:tc:SAML:1.0:assertion"><saml:NameIdentifier Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified">' + e + "</saml:NameIdentifier></saml:Subject></samlp:AuthenticationQuery></samlp:Request></SOAP:Body></SOAP:Envelope>" } function i(n) { var r, s = t(n).find("AssertionArtifact, saml\\:NameIdentifier").text(), c = t(n).find("AssertionArtifact, samlp\\:Response").attr("IssueInstant"), l = t(n).find("AssertionArtifact, saml\\:Conditions").attr("NotOnOrAfter"); r = new Date(l).getTime() - new Date(c).getTime() - 3e5, a(), o = e.setTimeout(function () { var e = function (e) { return { data: d(e), contentType: 'text/xml; charset="utf-8"', type: "POST", dataType: "xml", url: u(), cache: !1, headers: { "cache-control": "no-cache" } } }(s); t.ajax(e).done(function (e) { f(t(e).find("AssertionArtifact, samlp\\:AssertionArtifact").text()), i(e) }) }, r > 1e4 ? r : 1e4) } function c(e) { return '<SOAP:Envelope xmlns:SOAP="http://schemas.xmlsoap.org/soap/envelope/"><SOAP:Header></SOAP:Header><SOAP:Body><samlp:Request xmlns:samlp="urn:oasis:names:tc:SAML:1.0:protocol" MajorVersion="1" MinorVersion="1" IssueInstant="2013-06-17T11:16:38Z" RequestID="a62d2508b9-b88e-b790-e41b-16b3ed3cc4c"><samlp:AssertionArtifact xmlns:samlp="urn:oasis:names:tc:SAML:1.0:protocol">' + e + "</samlp:AssertionArtifact></samlp:Request></SOAP:Body></SOAP:Envelope>" } function d(e) { return '<SOAP:Envelope xmlns:SOAP="http://schemas.xmlsoap.org/soap/envelope/"><SOAP:Header></SOAP:Header><SOAP:Body><samlp:Request xmlns:samlp="urn:oasis:names:tc:SAML:1.0:protocol" MajorVersion="1" MinorVersion="1" IssueInstant="2013-06-14T11:25:34Z" RequestID="a71b2d2cc3-cc5b-d45c-39dd-87c5cb708b2"><samlp:AuthenticationQuery><saml:Subject xmlns:saml="urn:oasis:names:tc:SAML:1.0:assertion"><saml:NameIdentifier Format="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified">' + e + "</saml:NameIdentifier></saml:Subject></samlp:AuthenticationQuery></samlp:Request></SOAP:Body></SOAP:Envelope>" } function u() { var e = t.cordys.authentication.sso.defaults.loginGatewayURL, n = t.cordys.getCookieObject("\\w*_ct"); return n.value && (e = t.cordys.addURLParameter(e, n.key, n.value)), e } function l(e) { r.cookies.saml.name = e.SamlArtifactCookieName.text, r.cookies.ct.name = e.CheckName.text, r.cookies.ct.valid = !0, r.cookies.path = e.SamlArtifactCookiePath.text || "/" } function f(e) { var n, o, a; r.cookies.saml.value = e, r.cookies.saml.valid = !0, n = r.cookies.saml.name, o = r.cookies.saml.value, a = r.cookies.path, document.cookie = n + "=" + o + "; path=" + a, n && ("undefined" == typeof hex_sha1 ? t.cordys.loadScript("/cordys/thirdparty/sha1/sha1.js", function () { p(o) }) : p(o)) } function p(e) { var t = hex_sha1(e); document.cookie = r.cookies.ct.name + "=" + t + "; path=" + r.cookies.path } t.cordys.authentication.sso.initializeSessionFromArtifact() }(window, jQuery), function (e, t, n) { t.cordys.binding = function () { this.isReadOnly = function () { return !0 }, this.getSize = function () { t.error("Method 'getSize' should be implemented by the binding handler") }, this.clear = function () { t.error("Method 'clear' should be implemented by the binding handler") }, this.getBindingObject = function (e) { t.error("Method 'getBindingObject' should be implemented by the binding handler") }, this.addBindingObjects = function (e) { t.error("Method 'addBindingObjects' should be implemented by the binding handler") }, this.getJSObject = function (e) { t.error("Method 'getJSObject' should be implemented by the binding handler") }, this.getInitialState = function (e) { t.error("Method 'getInitialState' should be implemented by the binding handler") }, this.isInsertedObject = function (e) { t.error("Method 'isInsertedObject' should be implemented by the binding handler") }, this.isUpdatedObject = function (e) { t.error("Method 'isUpdatedObject' should be implemented by the binding handler") }, this.isDeletedObject = function (e) { t.error("Method 'isDeletedObject' should be implemented by the binding handler") }, this.insertObject = function (e) { t.error("Method 'insertObject' should be implemented by the binding handler") }, this.updateObject = function (e) { t.error("Method 'updateObject' should be implemented by the binding handler") }, this.removeObject = function (e) { t.error("Method 'removeObject' should be implemented by the binding handler") }, this.revertObject = function (e) { t.error("Method 'revertObject' should be implemented by the binding handler") }, this.synchronizeObject = function (e, n) { t.error("Method 'synchronizeObject' should be implemented by the binding handler") }, this.bindObjects = function (e, n) { t.error("Method 'bindObjects' should be implemented by the binding handler") } } }(window, jQuery), window, jQuery.cordys.binding.jsrender = function (e, t) { var n = []; this.getBindingObject = function (e) { return e }, this.clear = function () { n = [] }, this.getSize = function () { return n.length }, this.getObjects = function () { return n }, this.addBindingObjects = function (t) { n = t, e[e.objectName] = n }, this.bindObjects = function (e, n) { if (!t.binding.template) return console.log("Binding Template not specified"); var o = t.binding.template.render(n); e.html(o).listview("refresh") } }, function (e, t, n) { t.cordys.binding.knockout = function (e, n) { var r = this; "undefined" == typeof ko && t.cordys.loadScript(t.cordys.addOrganizationContextToURL("/cordys/thirdparty/knockout/knockout.js")), void 0 === ko.mapping && t.cordys.loadScript(t.cordys.addOrganizationContextToURL("/cordys/thirdparty/knockout/knockout.mapping.js")); var s = t.extend({}, n); s.mappingOptions = s.mappingOptions || {}, s.mappingOptions.ignore = s.mappingOptions.ignore || [], s.mappingOptions.ignore.push("_destroy"); var i = function (e, n) { t.each(e, function (e, t) { var o = "string" == typeof t ? t : t.name, r = n ? n + "." + o : o; (void 0 !== t.persisted ? t.persisted : "string" == typeof t || !(t.computed || t.path)) ? s.mappingOptions.include.push(r) : s.mappingOptions.ignore.push(r), t.fields && i(t.fields, r) }) }; s.fields && (s.mappingOptions.include = s.mappingOptions.include || [], i(s.fields, void 0)); var c = e[e.objectName] = ko.observableArray(); e.selectedItem = ko.observable(), void 0 !== s.context && ko.applyBindings(e, s.context), this.isReadOnly = function () { return !1 }, this.getSize = function () { return "function" == typeof c ? c().length : c.length }, this.getBindingObject = function (t) { var n = o(t, null, s.fields, s.mappingOptions, e.isReadOnly); return e.isReadOnly || a(e, s, t, n, !1), n }, this.getJSObject = function (e) { return ko.mapping.toJS(e) }, this.synchronizeObject = function (e, t) { t ? e.lock && e.lock.isDirty() ? e.lock._update(t) : e.lock || (a(r, s, t, e, !1), e.lock._update(t)) : c.remove(e) }, this.bindObjects = function (e, t) { }, this.clear = function () { this.getSize() > 0 && c.removeAll() }, this.insertObject = function (t) { return t ? (ko.isObservable(t) || (t = o(t, null, s.fields, s.mappingOptions, e.isReadOnly)), c.push(t), t) : null }, this.getInitialState = function (e) { return e.lock.getInitialState() }, this.removeObject = function (t) { return t ? "function" != typeof e[e.objectName] ? null : (t.lock ? e[e.objectName].destroy(t) : e[e.objectName].remove(t), t) : null }, this.revertObject = function (t) { t.lock ? (t.lock.isDirty() && t.lock.undo(), !0 === t._destroy && t.lock._undestroy()) : e[e.objectName].remove(t) }, this.isInsertedObject = function (e) { return !e.lock && !0 !== e._destroy }, this.isUpdatedObject = function (e) { return e.lock && e.lock.isDirty() }, this.isDeletedObject = function (e) { return e.lock && !0 === e._destroy }, this.getObjects = function () { return c() }, this.addBindingObjects = function (e) { return c(e) } }; var o = function (e, t, n, o, a) { var s = a ? e : t ? ko.mapping.fromJS(e, o, t) : ko.mapping.fromJS(e, o); return n && (s = r(e, s, n, null, !a, t)), s }, r = function (e, n, o, a, s, i) { return a || (a = e), t.each(o, function (o, i) { if ("string" == typeof i) n[i] ? e[i] || (s ? n[i](void 0) : n[i] = void 0) : n[i] = s ? ko.observable() : void 0; else { if (!i.name) throw new Error("Mandatory property 'name' not specified"); var c = ko.utils.unwrapObservable(n[i.name]); if (void 0 === c && (c = i.defaultValue), i.path) { var d = i.path.split("."); c = e; for (o = 0; o < d.length && void 0 !== c; o++)c = "$root" == d[o] ? a : ko.utils.unwrapObservable(c[d[o]]) } if (i.computed) return ko.isComputed(n[i.name]) || (n[i.name] = ko.computed(i.computed, n)), n; if (i.isArray ? (c ? t.isArray(c) || (c = [c]) : c = [], t.isArray(n[i.name]) ? s ? n[i.name](c) : n[i.name] = c : n[i.name] = s ? ko.observableArray(c) : c) : (n[i.name] && !i.path || i.fields || (n[i.name] ? s ? n[i.name](c) : n[i.name] = c : n[i.name] = s ? ko.observable(c) : c), i.fields && (n[i.name] = c || {})), i.fields) if (n[i.name] = n[i.name] || c || {}, t.isArray(c)) { var u = ko.isObservable(n[i.name]) ? n[i.name]() : n[i.name]; for (o = 0; o < c.length; o++)r(c[o], u[o], i.fields, a, s) } else r(c, n[i.name], i.fields, a, s) } }), n }, a = function (e, t, n, r, a) { var s = function () { }, i = n, c = ko.mapping.toJSON(r), d = ko.observable(a); return s.getInitialState = function () { return i }, s.isDirty = function () { return r && (d() || c !== ko.mapping.toJSON(r)) }, s._updateLock = function (e) { i = e || ko.mapping.toJS(r), c = ko.mapping.toJSON(r), d(!1) }, s._update = function (e) { o(e, r, t.fields, t.mappingOptions, !1), this._updateLock(e) }, s._undestroy = function () { e[e.objectName].valueWillMutate(), delete r._destroy, e[e.objectName].valueHasMutated() }, s.undo = function () { this.isDirty() && this._update(i) }, r.lock = s, s } }(window, jQuery), function (e, t, n) { if (!t.cordys) throw new Error("The Cordys HTML5 SDK is required, please ensure it is loaded properly"); function o(e, n, o, r) { n = n || {}; var a = t.extend({ method: e, namespace: r || "http://schemas.cordys.com/casemanagement/execution/1.0" }, n); return a.parameters = t.extend(o, n.parameters), a } function r(e) { var t = "object" == typeof e ? e.ProcessInstanceId || e.CaseInstanceId || e.caseinstanceid : e; return "function" == typeof t ? t() : t } function a(e) { var t = { "@xmlns:case": "http://schemas.cordys.com/casemanagement/1.0", "@name": "case:casevariables", "case:casevariables": {} }; for (var n in e) { var o = 0 !== n.indexOf("case:") ? "case:" + n : n; t["case:casevariables"][o] = e[n] } return t } t.cordys.case = new function () { return this.createCase = function (e, n, r, s) { return n && ((r = r || { data: {} }).data.constructor !== Array && (r.data = [r.data]), r.data.push(a(n))), s = o("CreateCase", s, { model: e, casedata: r }), t.cordys.ajax(s) }, this.getActivityDefinition = function (e, n, a) { return (a = o("GetActivityDefinition", a)).parameters = a.parameters || {}, t.extend(a.parameters, { caseinstanceid: r(e), activities: { activityid: n } }), t.cordys.ajax(a).then(function (e) { return t.cordys.json.findObjects(e, "case:activity") }) }, this.getActivityInstance = function (e, n, a) { return (a = o("GetActivityInstance", a)).parameters = a.parameters || {}, t.extend(a.parameters, { caseinstanceid: r(e), activityinstanceid: n }), t.cordys.ajax(a).then(function (e) { return t.cordys.json.find(e, "ACTIVITY_INSTANCE") }) }, this.getActivityInstances = function (e, n) { return (n = o("GetActivityInstances", n)).parameters = n.parameters || {}, t.extend(n.parameters, { caseinstanceid: r(e) }), t.cordys.ajax(n).then(function (e) { return t.cordys.json.findObjects(e, "ACTIVITY_INSTANCE") }) }, this.getBusinessEvents = function (e, n, a) { return (a = o("GetBusinessEvents", a)).parameters = a.parameters || {}, a.parameters.caseinstanceid = r(e), a.parameters.activityid = n, t.cordys.ajax(a).then(function (e) { return t.cordys.json.findObjects(e, "case:event") }) }, this.getCaseInstance = function (e, n) { return (n = o("GetCaseInstance", n)).parameters = n.parameters || {}, n.parameters.caseinstanceid = r(e), t.cordys.ajax(n).then(function (e) { return t.cordys.json.find(e, "CASE_INSTANCE") }) }, this.getCaseData = function (e, n) { return (n = o("GetCaseData", n)).parameters = n.parameters || {}, n.parameters.caseinstanceid = r(e), t.cordys.ajax(n).then(function (e) { return t.cordys.json.find(e, "casedata") }) }, this.getCaseVariables = function (e, n) { return (n = o("GetCaseVariables", n)).parameters = n.parameters || {}, n.parameters.caseinstanceid = r(e), t.cordys.ajax(n).then(function (e) { var n = t.cordys.json.find(e, "casedata"), o = n.data["case:casevariables"], r = {}; for (var a in o) "object" == typeof o[a] && (r[a.replace(/^[^:]*:/, "")] = o[a]); return n.data = { casevariables: r }, n }) }, this.getFollowupActivities = function (e, n, a) { return (a = o("GetFollowupActivities", a)).parameters = a.parameters || {}, a.parameters.caseinstanceid = r(e), a.parameters.activityid = n, t.cordys.ajax(a).then(function (e) { return t.cordys.json.findObjects(e, "case:followup") }) }, this.planActivities = function (e, n, a) { return a = o("PlanActivities", a, { caseinstanceid: r(e), planactivities: { activity: n } }), t.cordys.ajax(a).then(function (e) { return t.cordys.json.findObjects(e, "state") }) }, this.planIntermediateActivities = function (e, n, a, s, i) { return i = o("PlanIntermediateActivities", i, { caseinstanceid: r(e), activityinstanceid: { "@activityid": a, text: n }, planactivities: { activity: s } }), t.cordys.ajax(i) }, this.sendEvent = function (e, n, a, s) { return s = o("SendEvent", s, { caseinstanceid: r(e), event: { text: n, "@source": a } }), t.cordys.ajax(s) }, this.updateCaseData = function (e, n, a) { return a = o("UpdateCaseData", a, { caseinstanceid: r(e), casedata: n }), t.cordys.ajax(a) }, this.updateCaseVariables = function (e, n, s, i) { return i = o("UpdateCaseVariables", i, { caseinstanceid: r(e), casedata: { "@lockID": s, data: a(n) } }), t.cordys.ajax(i) }, this } }(window, jQuery), function (e, t, n) { t.cordys || (t.cordys = {}), t.cordys.ajax || t.cordys.loadScript(t.cordys.addOrganizationContextToURL("/cordys/html5/plugins/cordys.ajax.js")), t.cordys.binding || t.cordys.loadScript(t.cordys.addOrganizationContextToURL("/cordys/html5/plugins/cordys.binding.js")), t.cordys.model = function (e) { var n = this, o = t.extend({}, t.cordys.model.defaults, e); this.objectName = e.objectName, this.isReadOnly = e.hasOwnProperty("isReadOnly") ? !0 === e.isReadOnly : void 0 === (e.create || e.update || e.delete) && t.cordys.model.defaults.isReadOnly, o.binding && o.binding.hasOwnProperty("handler") && !o.binding.handler && t.error("The model binding handler specified in the binding options is not available"); var r = o.binding && o.binding.handler || t.cordys.binding.knockout; r.prototype = new t.cordys.binding; var a = new r(n, o); !this.isReadOnly && a.isReadOnly() && t.error("The model binding handler is readonly and does not support CRUD operations"), this.getBindingHandler = function () { return a }, this.read = function (r) { var a = t.extend(!0, {}, e.defaults, e.read, r); return a._$Def = t.Deferred(), a.context = a, t.cordys.ajax(a).done(function (e) { if (o.useTupleProtocol) var r = p(e, "tuple"), a = t.map(r, function (e, t) { var o = e.new ? e.new[n.objectName] : e.old[n.objectName]; return o.getTuple = function () { return e }, o }); else a = p(e, n.objectName); f(e, a.length), a = n.putData(a), this._$Def.resolve(a, this) }).fail(function (e, t, n) { this._$Def.reject(e, t, n, this) }), a._$Def.promise() }, this.putData = function (e) { var r = t.isArray(e) ? e : p(e, n.objectName); if (0 == r.length && "object" == typeof e && (r = e.length ? [e] : []), r.length > 0) { for (var s in r) { var i = r[s], c = a.getBindingObject(i); r[s] = c } this.clear(), a.addBindingObjects(r), a.bindObjects(o.context, r) } return r }, this.getSize = function () { return a.getSize() }, this.clear = function () { a.clear() }, this.addBusinessObject = function (e) { return a.insertObject(e) }, this.removeBusinessObject = function (e) { return a.removeObject(e) }, this.revert = function (e) { if (void 0 !== e) a.revertObject(e); else { var t = a.getObjects(); for (var n in t) { var o = t[n]; a.revertObject(o) } } }, this.getNextPage = function (e) { return n.cursor && (e = t.extend(!0, {}, e, { parameters: { cursor: n.cursor } })), this.read(e) }, this.getPreviousPage = function (e) { if (n.cursor) { var o = n.cursor["@position"] - 2 * n.cursor["@numRows"]; n.cursor["@position"] = o < 0 ? 0 : o, e = t.extend(!0, {}, e, { parameters: { cursor: n.cursor } }) } return this.read(e) }, this.hasNext = function () { return 0 !== this.getSize() && (void 0 !== n.cursor && void 0 !== n.cursor["@position"] && (void 0 !== n.cursor["@id"] && (void 0 === n.cursor["@position"] ? 0 : parseInt(n.cursor["@position"])) < (void 0 === n.cursor["@maxRows"] ? 0 : parseInt(n.cursor["@maxRows"])))) }, this.hasPrevious = function () { if (0 === this.getSize()) return !1; if (void 0 === n.cursor) return !1; var e = void 0 === n.cursor["@position"] ? 0 : parseInt(n.cursor["@position"]); return 0 !== e && e > (void 0 === n.cursor["@numRows"] ? 0 : parseInt(n.cursor["@numRows"])) }, this.create = function (n) { var o = t.extend(!0, {}, e.defaults, e.create, n); return o.synchronizeContent = s(o, !0, !1, !1), i(o) }, this.update = function (n) { var o = t.extend(!0, {}, e.defaults, e.update, n); return o.synchronizeContent = s(o, !1, !0, !1), i(o) }, this.delete = function (n) { var o = t.extend(!0, {}, e.defaults, e.delete, n); return o.synchronizeContent = s(o, !1, !1, !0), i(o) }, this.synchronize = function (n) { var o = t.extend(!0, {}, e.defaults, e.update, n); return o.synchronizeContent = s(o, !0, !0, !0), i(o) }; var s = function (e, n, r, s) { var i = [], c = [], d = a.getObjects(); if (d) for (var f in d) { var p = d[f]; if (s && a.isDeletedObject(p)) if (a.isInsertedObject(p)) a.synchronizeObject(p); else { c.push(p); var y = a.getInitialState(p); i.push(o.useTupleProtocol ? u(y, null) : l(o.objectName, y)) } else if (r && a.isUpdatedObject(p)) { c.push(p); y = a.getInitialState(p); var m = a.getJSObject(p); i.push(o.useTupleProtocol ? u(y, m) : l(o.objectName, m)) } else if (n && a.isInsertedObject(p)) { c.push(p); m = a.getJSObject(p); i.push(o.useTupleProtocol ? u(null, m) : l(o.objectName, m)) } } return e.objectsToBeUpdated = c, c.length > 0 ? t.cordys.json.js2xmlstring(i, e.json) : "" }, i = function (e) { if (e._$Def = t.Deferred(), e.context = e, n.isReadOnly || 0 == e.objectsToBeUpdated.length) e._$Def.reject(null, "canceled", null, e); else { var o = e.parameters ? t.cordys.json.js2xmlstring(e.parameters) : void 0; o && ">" != o.charAt(o.length - 1) && (o += ">"), e.parameters = o ? o + e.synchronizeContent : e.synchronizeContent, t.cordys.ajax(e).done(function (e, t, n) { d(e, this.objectsToBeUpdated), this._$Def.resolve(e, t, this) }).fail(function (e, t, n) { c(e.fail(), this.objectsToBeUpdated), this.showError && showErrorDialog(e.fail(), "Error on Update"), this._$Def.reject(e, t, n, this) }) } return e._$Def.promise() }, c = function (e, r) { if (o.useTupleProtocol) for (var s = t(e.responseXML).find("detail tuple"), i = 0; i < s.length; i++) { var c = s[i]; if (t(c).find("error").length > 0) { var d = t(c).find("new")[0], u = t(c).find("old")[0], l = r[i]; if (d) { if (u) { var f = p(t.cordys.json.xml2js(u), n.objectName)[0]; a.synchronizeObject(l, f) } } else { f = p(t.cordys.json.xml2js(u), n.objectName)[0]; a.synchronizeObject(l, f) } } } }, d = function (e, r) { var s; s = o.useTupleProtocol ? t.map(t.isArray(e.tuple) ? e.tuple : [e.tuple], function (e) { return p(e.new ? e.new : e.old, n.objectName) }) : p(e, n.objectName); for (var i = 0; i < r.length; i++) { var c = r[i]; a.isDeletedObject(c) ? a.synchronizeObject(c) : a.synchronizeObject(c, o.useTupleProtocol ? s[i] : a.getJSObject(c)) } }, u = function (e, t) { var o = e && e.getTuple && e.getTuple() || t && t.getTuple && t.getTuple() || {}; return e && e.getTuple && delete e.getTuple, e ? o.old = l(n.objectName, e) : delete o.old, t && t.getTuple && delete t.getTuple, t ? o.new = l(n.objectName, t) : delete o.new, { tuple: o } }, l = function (e, t) { var n = {}; return n[e] = t, n }, f = function (e, t) { var o = p(e, "cursor")[0]; if (void 0 !== o && void 0 === o["@id"] && void 0 !== n.cursor && void 0 !== n.cursor["@position"]) { if (0 === t) return o["@position"] = parseInt(n.cursor["@position"]), n.cursor = o, n.clear(), !1; o["@position"] = parseInt(n.cursor["@position"]) + parseInt(o["@numRows"]) } n.cursor = o || null }, p = function (e, n, o) { var r = []; for (var a in e) if (e.hasOwnProperty(a)) if ("object" == typeof e[a]) if (a == n) if (t.isArray(e[a])) for (var s = 0; s < e[a].length; s++)r.push(e[a][s]); else r.push(e[a]); else r = r.concat(p(e[a], n, o)); else a == n && e[n] == o && r.push(e); return r } }, t.cordys.model.defaults = { useTupleProtocol: !0, isReadOnly: !0 } }(window, jQuery), function (e, t, n) { var o = {}, r = t.cordys.getTopLevelWindow ? t.cordys.getTopLevelWindow(e) : getTopLevelWindow(e); function a() { return -(new Date).getTimezoneOffset() } function s(n) { if (t.cordys.isMobile && t.cordys.mobile && t.cordys.mobile.globalization) t.cordys.mobile.globalization.getLocaleName().done(function (e) { c(e, e, a()) }).fail(function (e) { i(), n.resolve(o) }); else if (language = e.navigator.language || e.navigator.userLanguage) { var r, s; (r = e.navigator.userAgent) && (s = r.match(/android.*\W(\w\w[_-]\w\w)\W/i)) && (language = s[1]), language = language.replace("_", "-").replace(/(-[a-z]{2})/, function (e, t) { return t.toUpperCase() }), c(language, language, a()), n.resolve(o) } else void 0 !== t.cordys.ajax ? t.cordys.ajax({ url: "/cordys/com.cordys.translation.gateway.TranslationGateway.wcp", data: "", dataType: "xml", error: function () { return !1 } }).done(function (e) { var r = t.cordys.json.xml2js(e); if (r && r.browserpreferences) { var s = r.browserpreferences.language; c(s, s, a()), n.resolve(o) } else i(), n.resolve(userPreferences) }).fail(function (e, t, o) { i(), n.resolve(userPreferences) }) : (i(), n.resolve(userPreferences)); return n.promise() } function i() { o.language = o.language || t.cordys.translation && t.cordys.translation.defaultLanguage, o.locale = o.locale || o.language, o.timezoneoffset = o.timezoneoffset || a() } function c(e, t, n) { o.language = o.language || e, o.locale = o.locale || t, o.timezoneoffset = o.timezoneoffset || n } t.cordys || (t.cordys = {}), t.cordys.preferences = { getUserPreferences: function () { var n = t.Deferred(); if (n.done(function (e) { sessionStorage.setItem("preferences", JSON.stringify(e)) }), r.$Cordys_LoginDef && r.$Cordys_LoginDef.done(function () { sessionStorage.removeItem("preferences") }), "function" == typeof t.cordys.getURLParameter && (o.language = t.cordys.getURLParameter(e.location, "language"), o.locale = t.cordys.getURLParameter(e.location, "locale"), o.timezoneoffset = t.cordys.getURLParameter(e.location, "timezoneoffset")), sessionStorage && sessionStorage.preferences) { var i = t.parseJSON(sessionStorage.getItem("preferences")); c(i.language, i.locale, i.timezoneoffset) } return o.language && o.locale && o.timezoneoffset ? n.resolve(o) : "undefined" != typeof Cordys && void 0 !== Cordys.getLocale ? Cordys.getLocale().done(function (e) { c(e, e, a()), n.resolve(o) }) : void 0 !== t.cordys.ajax && t.cordys.ajax({ method: "GetXMLObject", namespace: "http://schemas.cordys.com/1.0/xmlstore", dataType: "xml", parameters: { key: "/Cordys/WCP/Desktop/Preferences/Cordys/WCP/desktop" } }).then(function (e) { var r = t(e).find("timezone") || "", a = t(e).find("locale") || "", i = t(e).find("userlanguage") || ""; o.locale = o.locale || a && a.text() || "", o.language = o.language || i && i.text() || "", (r = r && r.text() || "") && !o.timezoneoffset ? (r = r.replace(new RegExp("[/:]", "g"), "_"), t.get(t.cordys.addOrganizationContextToURL("/cordys/cas/xforms/scripthostlibrary/timezones/" + r + ".xml")).done(function (e) { o.timezoneoffset = t(e).find("utcOffset").text(), o.language && o.locale && o.timezoneoffset ? n.resolve(o) : s(n) }).fail(function () { o.language && o.locale && o.timezoneoffset ? n.resolve(o) : s(n) })) : s(n) }), n.promise() } } }(window, jQuery), function (e, t, n) { if (!t.cordys) throw new Error("The Cordys HTML5 SDK is required, please ensure it is loaded properly"); function o(e) { var t = "object" == typeof e ? e.ProcessInstanceId || e.SourceInstanceId : e; return "function" == typeof t ? t() : t } t.cordys.process = new function () { return this.getBusinessIdentifiers = function (e, n) { var r = (n = function (e, n, o, r) { o = o || {}; var a = t.extend({ method: e, namespace: n || "http://schemas.cordys.com/bpm/execution/1.0" }, o); return a.parameters = t.extend(r, o.parameters), a }("GetBusinessIdentifierValues", "http://schemas.cordys.com/pim/queryinstancedata/1.0", n, { processInstanceID: o(e) })).success; return n.success = null, t.cordys.ajax(n).then(function (e) { var n = t.cordys.json.findObjects(e, "BusinessIdentifier"); return n = n.sort(function (e, t) { return parseInt(e.Sequence) > parseInt(t.Sequence) }), r && r(n), n }) }, this.startProcess = function (e, n, o) { return (o = o || {}).parameters = t.extend({ type: "definition" }, o.parameters), this.executeProcess(e, n, o) }, this.executeProcess = function (e, n, r) { var a, s, i, c; return r = r || {}, t.isArray(r.parameters) ? r.parameters = (a = r.parameters || [], s = [{ name: "receiver", value: o(e) }, { name: "type", value: "instance" }, { name: "message", value: n }], i = "name", c = a, t.each(s, function () { var e = this[i], n = !1; t.each(a, function () { this[i] == e && (n = !0) }), n || c.push(this) }), c) : r.parameters = t.extend({ receiver: o(e), type: "instance", message: n }, r.parameters), r = t.extend({ method: "ExecuteProcess", namespace: "http://schemas.cordys.com/bpm/execution/1.0" }, r), t.cordys.ajax(r) }, this } }(window, jQuery), function (e, t, n) { t.cordys || (t.cordys = {}); var o = []; t.cordys.translation = { defaultLanguage: "en-US", xmlstoreRootPath: "/Cordys/WCP/Javascript/translation/", nativeRootPath: "translation/", webRootPath: "/cordys/html5/translation/" }, t.cordys.translation.getBundle = function (e, t, n) { return r(t).then(function (t) { var r = (e = e.replace(/^[\/\\]/, "")) + "_" + t, s = o[r]; return s || (o[r] = s = new a(e, t, n)), s }) }, t.cordys.translation.getSystemBundle = function (e) { return this.getBundle("html5sdk/sdkmessagebundle", e, !0) }; var r = function (e) { var n = t.Deferred(); return e ? n.resolve(e) : t.cordys.preferences.getUserPreferences().done(function (e) { var o = e.language || t.cordys.translation.defaultLanguage; n.resolve(o) }), n.promise() }, a = function (e, n, o) { var r = this; this.path = e, this.dictionary = null, this.getMessage = function () { var e = arguments[0], o = null, a = ""; if (r.dictionary && (o = t.cordys.json.find(r.dictionary, "@textidentifier", e)), a = o && o[n] ? o[n].text || o[n] : e, arguments.length > 1) { var s = Array.prototype.slice.call(arguments).slice(1); a = a.replace(/\{(\d+)\}/g, function () { return void 0 !== s[arguments[1]] ? s[arguments[1]] : arguments[0] }) } return a }, this.translate = function (e, n) { e || (e = "[data-translatable='true']"), t(e).each(function () { var e = t(this); n ? n.call(this, r.getMessage(e.is(":input") ? e.val() : e.text())) : e.is(":input") ? e.is("[placeholder]") ? e.attr("placeholder", r.getMessage(e.attr("placeholder").trim())) : e.val(r.getMessage(e.val().trim())) : e.text(r.getMessage(e.text().trim())) }), t.validator && t.validator.messages && t.extend(t.validator.messages, { required: r.getMessage("REQUIRED"), remote: r.getMessage("REMOTE"), email: r.getMessage("EMAIL"), url: r.getMessage("URL"), date: r.getMessage("DATE"), dateISO: r.getMessage("DATE_ISO"), number: r.getMessage("NUMBER"), digits: r.getMessage("DIGITS"), creditcard: r.getMessage("CREDITCARD"), equalTo: r.getMessage("EQUALTO"), maxlength: t.validator.format(r.getMessage("MAX_LENGTH")), minlength: t.validator.format(r.getMessage("MIN_LENGTH")), rangelength: t.validator.format("RANGE_LENGTH"), range: t.validator.format("RANGE"), max: t.validator.format("MAX"), min: t.validator.format("MIN") }) }; var a = t.Deferred(), s = function (e, n, o) { var s = e + "_" + n; return o || void 0 === t.cordys.ajax ? t.ajax({ type: "GET", url: (o ? t.cordys.addOrganizationContextToURL(t.cordys.translation.webRootPath) : t.cordys.translation.nativeRootPath) + s + ".xml", async: !0, cache: !0, dataType: "xml", success: function (e) { r.dictionary = t.cordys.json.find(t.cordys.json.xml2js(e), "dictionary"), a.resolve(r) }, error: function () { -1 != n.indexOf("-") ? (s = e + "_" + n.substring(0, n.indexOf("-")), t.ajax({ type: "GET", url: (o ? t.cordys.addOrganizationContextToURL(t.cordys.translation.webRootPath) : t.cordys.translation.nativeRootPath) + s + ".xml", async: !0, dataType: "xml", cache: !0 }).then(function (e) { r.dictionary = t.cordys.json.find(t.cordys.json.xml2js(e), "dictionary"), a.resolve(r) }, c)) : (r.dictionary = {}, a.resolve(r)) } }) : i(s).then(function (o) { r.dictionary = t.cordys.json.find(o, "dictionary"), r.dictionary ? a.resolve(r) : -1 != n.indexOf("-") ? i(s = e + "_" + n.substring(0, n.indexOf("-"))).then(function (e) { r.dictionary = t.cordys.json.find(e, "dictionary"), a.resolve(r) }, c) : a.resolve(r) }, c) }; function i(e) { return t.cordys.ajax({ method: "GetXMLObject", namespace: "http://schemas.cordys.com/1.0/xmlstore", context: r, parameters: { key: t.cordys.translation.xmlstoreRootPath + e + ".mlm" } }) } var c = function (r, i, c) { n !== t.cordys.translation.defaultLanguage ? s(e, t.cordys.translation.defaultLanguage, o) : (a.reject(), console.log("An error occurred while retrieving the language package. The error details are as follows: " + i)) }; return s(this.path, n, o), a } }(window, jQuery), function (e, t, n) { if (!t.cordys) throw new Error("The Cordys HTML5 SDK is required, please ensure it is loaded properly"); function o(e, n, o, r) { o = o || {}; var a = t.extend({ method: e, namespace: n || "http://schemas.cordys.com/notification/workflow/1.0" }, o); return a.parameters = t.extend(r, o.parameters), a } function r(e) { var t = "object" == typeof e ? e.TaskId : e; return "function" == typeof t ? t() : t } function a(e) { return "object" != typeof e ? "" : e.SourceType || e.Component } function s(e) { if ("string" == typeof e) return e; var n = t.cordys.workflow.isCaseActivity(e) ? e.ProcessInstanceId || e.CaseInstanceId || e.SourceInstanceId || e.RootInstanceId || e.caseinstanceid : e.ProcessInstanceId || e.SourceInstanceId; return "function" == typeof n ? n() : n } t.cordys.workflow = new function () { return this.getTasks = function (e) { return e = o("GetTasks", "", e, { OrderBy: "Task.StartDate DESC", ShowNonWorkableItems: "false", ReturnTaskData: "false" }), t.cordys.ajax(e).then(function (e) { return t.cordys.json.findObjects(e, "Task") }) }, this.getAllTasksForUser = function (e) { return e = o("GetAllTasksForUser", "", e, { OrderBy: "Task.StartDate DESC" }), t.cordys.ajax(e).then(function (e) { return t.cordys.json.findObjects(e, "Task") }) }, this.getPersonalTasks = function (e) { return e = o("GetTasks", "", e, { OrderBy: "Task.StartDate DESC" }), t.cordys.ajax(e).then(function (e) { return t.cordys.json.findObjects(e, "Task") }) }, this.getTaskDetails = function (e, n) { return (n = n || {}).parameters = n.parameters || {}, n.parameters.TaskId = r(e), n = o("GetTask", "", n, { ReturnTaskData: "true", RetrievePossibleActions: "true" }), t.cordys.ajax(n).then(function (e) { return t.cordys.json.find(e, "Task") }) }, this.getAllTargets = function (e) { return e = o("GetAllTargets", "", e, { TaskCountRequired: "true" }), t.cordys.ajax(e).then(function (e) { return t.cordys.json.findObjects(e, "Target") }) }, this.getWorkLists = function (e) { return e = o("GetAllWorklistsForUser", "", e), t.cordys.ajax(e).then(function (e) { return t.cordys.json.findObjects(e, "Worklist") }) }, this.claimTask = function (e, n) { return n = o("ClaimTask", "", n, { TaskId: r(e) }), t.cordys.ajax(n) }, this.delegateTask = function (e, n, a, s) { return s = o("DelegateTask", "", s, { TaskId: r(e), TransferOwnership: "true", Memo: a || "", SendTo: { UserDN: n } }), t.cordys.ajax(s) }, this.performTaskAction = function (e, n, a, s, i) { return i = o("PerformTaskAction", "", i, { TaskId: r(e), Action: a, Memo: s, Data: n || {} }), t.cordys.ajax(i) }, this.completeTask = function (e, t, n) { return this.performTaskAction(e, t, "COMPLETE", "", n) }, this.pauseTask = function (e, t, n) { return this.performTaskAction(e, t, "PAUSE", "", n) }, this.resumeTask = function (e, t, n) { return this.performTaskAction(e, t, "RESUME", "", n) }, this.revokeTask = function (e, t, n) { return this.performTaskAction(e, t, "REVOKECLAIM", "", n) }, this.skipTask = function (e, t, n, o) { return this.performTaskAction(e, t, "SKIP", n, o) }, this.startTask = function (e, t, n) { return this.performTaskAction(e, t, "START", "", n) }, this.stopTask = function (e, t, n) { return this.performTaskAction(e, t, "STOP", "", n) }, this.suspendTask = function (e, t, n) { return this.performTaskAction(e, t, "SUSPEND", "", n) }, this.isCaseActivity = function (e) { var t = a(e); return t ? "CASE" === t : -1 }, this.getAttachments = function (e, n) { if ("string" == typeof e) { var r = n ? n.async : void 0, i = t.cordys.ajax.defaults.async; return t.cordys.workflow.getTaskDetails(e, { async: n && void 0 !== r ? r : i }).then(function (e) { return t.cordys.workflow.getAttachments(e, n) }) } return n = o("GetAttachments", "http://schemas.cordys.com/bpm/attachments/1.0", n, { instanceid: { "@type": a(e), text: s(e) }, activityid: e.ActivityId || e.Activity["@id"] }), t.cordys.ajax(n).then(function (e) { return t.cordys.json.findObjects(e, "instance") }) }, this.addAttachment = function (n, r, i, c, d, u) { if ("string" == typeof n) { var l = u ? u.async : void 0, f = t.cordys.ajax.defaults.async; return t.cordys.workflow.getTaskDetails(n, { async: u && void 0 !== l ? l : f }).then(function (e) { return t.cordys.workflow.addAttachment(e, r, i, c, d, u) }) } if (!/^[a-zA-Z].*\:/.test(d)) { if (!/^[a-z0-9\+\/\s]+\={0,2}$/i.test(d) || d.length % 4 > 0) { if (!e.btoa) throw new Error("Unable to convert data to base64"); d = e.btoa(d) } return u = o("UploadAttachment", "http://schemas.cordys.com/bpm/attachments/1.0", u, { instanceid: { "@type": a(n), text: s(n) }, activityid: n.ActivityId || n.Activity["@id"], attachmentname: r, filename: i, description: c, content: { "@isURL": !1, text: d } }), t.cordys.ajax(u) } if (!t.cordys.mobile) throw new Error("Unable to add attachment by url"); t.cordys.mobile.fileReader.readAsDataURL(d, function (e) { d = e.replace(/^.*base64,/, ""), u = o("UploadAttachment", "http://schemas.cordys.com/bpm/attachments/1.0", u, { instanceid: { "@type": a(n), text: s(n) }, activityid: n.ActivityId || n.Activity["@id"], attachmentname: r, filename: i, description: c, content: { "@isURL": !1, text: d } }), t.cordys.ajax(u) }, function (e) { throw new Error("Unable to read file, error: " + JSON.stringify(e)) }) }, this.uploadAttachment = function (e, n, r, i, c, d) { if ("string" == typeof e) { var u = d.async, l = t.cordys.ajax.defaults.async; return t.cordys.workflow.getTaskDetails(e, { async: d && void 0 !== u ? u : l }).then(function (e) { return t.cordys.workflow.uploadAttachment(e, n, r, i, c, d) }) } return d = o("UploadAttachment", "http://schemas.cordys.com/bpm/attachments/1.0", d, { instanceid: { "@type": a(e), text: s(e) }, activityid: e.ActivityId || e.Activity["@id"], attachmentname: n, filename: r, description: i, content: { "@isURL": !0, text: c } }), t.cordys.ajax(d) }, this.removeAttachment = function (e, n, r, i, c) { if ("string" == typeof e) { var d = c.async, u = t.cordys.ajax.defaults.async; return t.cordys.workflow.getTaskDetails(e, { async: c && void 0 !== d ? d : u }).then(function (e) { return t.cordys.workflow.removeAttachment(e, n, r, i, c) }) } return c = o("DeleteAttachment", "http://schemas.cordys.com/bpm/attachments/1.0", c, { instanceid: { "@type": a(e), text: s(e) }, activityid: e.ActivityId || e.Activity["@id"], attachmentname: n, filename: r, documenturl: i }), t.cordys.ajax(c) }, this } }(window, jQuery);